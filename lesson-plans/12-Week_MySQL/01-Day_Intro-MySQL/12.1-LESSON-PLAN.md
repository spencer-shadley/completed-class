# 12.1 - Messing With MySQL

### Ins: Welcome Class

- 630-32 (2 min)

- SQL and MySQL and completely new and very different than what we're used to

- This the database part of our full stack development

- MERN getting closer

- Objectives

  - To have MySQL Workbench or Sequel Pro installed and running on everyone's computers

  - To create a localhost connection to a MySQL server and have everyone successfully connect to it

  - To successfully create, use, and populate a MySQL database with data

  - To successfully create, populate, and select data from a MySQL table

### Ins: Introduction to SQL and MySQL

- 632-37 (5 min)

- SQL > "structured query language"

- SQL is how we will communicate with databases

  - it's sort of like the servers API for databases to follow CRUD operations

- MySQL is open source to be installed on a server to allow SQL commands to affect the data on the server

- SQL updates structured data, stored in tables (like Excel / Google Sheets)

  - alternative are NoSQL databases for unstructured data (our "M" is actually Mongo)

### Ins: Creating a Localhost Connection Demo

- 637-47 (10 min)

- We don't have a server to connect to, instead we will setup "localhost connection"

  - This stores data locally as if it was an external server

- Create a new connection

  - Connection name: "local Istance MySQL"
  - Method: "Standard (TCP/IP)
  - Host: localhost
  - Port: 3306
  - Username: root (default)
  - "Store in Vault..." / "Store in keychain"
  - Schema: Empty

  - Click "Test Connection"
  - Double click the connection to open the SQL editor

### Everyone Do: 00-setup

- 647-52 (5 min)

- Install MySQL and workbench

### Stu: Creating a Localhost Connection

- 652-702 (10 min)

- extend if needed up to 30 min

- the UX of this program is bad and confusing

### Ins: Connections Vs. Databases

- 652-55 (3 min)

- Ask: have we made a DB? (no)

  - we have connected to a server which can hold databases, we still need to make one

  - connection is a road to an empty lot. Before populating the area we need to lay the foundation for houses (databases) and then build the houses (create tables)

- Show "SCHEMAS" tab on the left

  - only includes built-in sys database

### Ins: Creating a MySQL Database

- 655-7 (5 min)

- Create DB

  - Type `CREATE DATABASE animals_db;` (semicolon is needed)

    - creates a MySQL database on the server

  - Click the lightning-bolt icon in the editor to execute the code

    - At the bottom it updates with the result (success)

  - It's still not in our schemas though

    - right click in the schemas section and click "refresh"

    - database created!

### Ins: Creating a Table

- 7-10 (10 min)

- We now need to create tables within our database

  - draw on the whiteboard a database and some tables (animals db; people, crustacians, marsupials tables)

- add below db creation:

  ```sql
  USE animals_db;

  CREATE TABLE people (
    name VARCHAR(30) NOT NULL,
    has_pet BOOLEAN NOT NULL,
    pet_name VARCHAR(30),
    pet_age INTEGER
  );
  ```

- run the code - error: `animals_db` already exists

  - MySQL data is persistent, it cannot be deleted or overwritten unless specifcally stated to

  - instead we can highlight the section of code we want to run, excluding the CREATE TABLE

  - show table on left pane

### Stu: Setting Up FavoriteDB

- (10 min)

- Slack out the following file and instructions

- **File**:

  - `favorite_db_unsolved.sql` in `02-FavoriteDB-NoData/Unsolved`

- **Instructions**:

  - For the table favorite_foods...

    - Create the column "food" which can take in a 50 character string and cannot be NULL
    - Create the column "score" which can take in an integer

  - For the table favorite_songs...

    - Create the column "song" which can take in a 100 character string and cannot be NULL
    - Create the column "artist" which can take in a 50 character string
    - Create the column "score" which can take in an integer

  - For the table favorite_movies...

    - Create the column "movie" which can take in a string and cannot be NULL
    - Create the column "five_times" which can take in a boolean
    - create the column "score" which can take in an integer

  - BONUS: Go online and look into how one might go about adding data into a table.

### Everyone Do: Go Over FavoriteDB

- (15 min)

- Copy and paste the data inside of `favoriteDB.SQL` in `02-FavoriteDB-NoData/Solved` into MySQL Workbench or Sequel Pro to go over what each line of code does once more.

- Especially make sure to point out how `DEFAULT` works in this example, as this will help with the homework and make SQL easier to handle.
  - `DEFAULT` is used to insert a default value into a column. In this case, it is used to set the default `BOOLEAN` value for the `five_time` column to `false`.

### BREAK TIME

- (15 min)

### Adding and Updating Data In Tables

- (15 min)

- Once everyone is back from break, ask the class whether or not there is any data in our tables yet?

  - The answer is, of course, that there is still no data stored within the server. Unlike before, however, we are now all set to start adding data into our tables!

- Open up "animals_db" once more within MySQL Workbench and type `SELECT * FROM people;` into the editor before highlighting this line of code and running it. Explain this to your students as you type in the code.

- This will bring up a visual of the table we have created and students should note that there is nothing stored within the table just yet. We will be changing this now.

  - Moving back into the editor, type the following code into it while explaining what it does.

  ```sql
  INSERT INTO people (name, has_pet, pet_name, pet_age)
  VALUES ("Ahmed", true, "Rockington", 100);

  SELECT * FROM people;
  ```

- This code does pretty much what it says on the tin, it inserts data into the "people" table and then specifies what columns that data will be entered into. Values then places the data contained in the parentheses into the corresponding columns listed after the INSERT INTO statement.

- Enter the following code into the editor above the select statement and below the previous statement. Before running the three statements, however, ask the class what they think will happen to the table.

  ```sql
  INSERT INTO people (name, has_pet, pet_name, pet_age)
  VALUES ("Jacob", true, "Misty", 10);
  ```

- The code WILL run, but as you can see, the data from the first insert statement has been duplicated. This is because, unlike tables and databases, there can be identical data stored within a table. As such, students should make sure to be careful when adding insert statements into their code.

- Write the following lines of code into the editor underneath the last insert statement and ask the class what they think will happen to the table

  ```sql
  INSERT INTO people (name, has_pet)
  VALUES ("Peter", false);
  ```

- Highlight this line of code and the select statement to show how data has been added to only the "name" and "has_pet" columns of the table while the rest of the row has null values. This is because we filled only those columns that required data while those that did not require data were automatically filled with null values.

  - If we were to try to create a new row in our table without filling those columns requiring data, the code would return an error and would not be able to run.

- Oh! It looks like Peter actually DOES have a pet and we should probably change the data in our table to reflect this! Write the following statement and then see if anyone can figure out what it would do.

  ```sql
  UPDATE people
  SET has_pet = true
  WHERE name = "Peter";
  ```

- This code updates the data stored in the columns specified in the SET statement in the row where the data in the "name" column is equal to "Peter"

  - If we did not include that WHERE statement, then our UPDATE would have set the values for all columns instead of those of a specific row. That would have been a pretty major error and is why the WHERE statement is so important.

### Stu: Adding Data to FavoriteDB

- (10 min)

- Slack out the following instructions

- **Instructions**

  - It is time to add some data into FavoriteDB! The data that you add should be unique to you and you should try to test your skills in not only adding new data, but also attempt to update old data as well!

  - Try to add at least three rows of data to each table.

  - BONUS: Look into how you you might go about creating a column that can hold a default value within it and how default values work when creating new rows.

  - BONUS: Look into how you might go about creating a column with a default value that automatically go up with each new row

  - BONUS: Look into the concept of making a column the "primary key"

  - ULTRA BONUS: Try to create a column called "id" in one of your tables that can contain an integer, is the primary key for the table, cannot be NULL, and automatically increments with each new row added.

### Ins: The Value of Unique Values

- (5 min)

- You know, that duplicate data in our table is starting to become something of an eyesore... Let's change that! Type in the following line of code which should remove the rows that contain the string "Ahmed" within the "name" column.

  ```sql
  DELETE FROM people
  WHERE name = "Ahmed";
  ```

- Well... It deleted the duplicate! Too bad it also deleted the original row as well. That's a little annoying. See if the class understands why this happened.

  - Because the name "Ahmed" appears twice within the table, SQL assumes that we want to delete every column that contains that name and does not understand that we are simply trying to delete the duplicate.

- To prevent this kind of thing from occurring, programmers will oftentimes want to create a column that automatically populates each new row with unique data. This allows them to select and affect that row more easily.

- Open up `animalsDBWithID.sql` in `03-animals_dbWithID` and copy the code into MySQL Workbench before running it.

  - Be sure to note how we have now replaced our old update statement with one in which the WHERE statement now uses the id column to select the row we want to affect.

    - Explain that a **primary key** uniquely identifies a row.

      - `AUTO_INCREMENT` generates a new value for each inserted record in the table. By default, the starting value for `AUTO_INCREMENT` is 1, and it will increment by 1 for each new record. We're using this with our unique `PRIMARY KEY` so we automatically get unique, incrementing values for each table row.

      - Point out that, because it auto-increments, each row's ID is guaranteed to be unique. This ensures that we don't identify and update the wrong row when we execute CRUD statements.

      - Point out that our insert statements have not changed, as we do not need to insert data specifically into the id column. MySQL automatically provides a value for this column, fulfilling the uniqueness constraint by automatically incrementing the last value used as an ID.

- We purposefully included the same kind of error that we had within the other code where there are two identical rows. Thanks to the auto-incrementing primary key of id, however, we can now more easily remove the duplicate through using the following code.

  ```sql
  DELETE FROM people
  WHERE id = 2;
  ```

- This does precisely what we wanted it to: Delete the duplicate, and preserve the original.

### Stu: Making and Using an ID Column

- (10 min)

- Slack out the following instructions

- **Instructions**

  - Make a new database called "programming_db" and switch into it for this activity

  - Create a table called "programming_languages" which includes a primary key named "id" which will automatically increment which each new row created, a string column called "languages," and a numeric column called "rating."

  - Insert some data into the table and then modify the data using the id column.

  - BONUS: Study up on how to add columns to a table and then create a boolean column called "mastered" which has a default value of `true`.

  - BONUS: Start looking into the concept of joins in SQL

### Everyone Do: programming_db Solution

- (15 min)

- Open up `programmingDB` in `04-programmingDB/Solved` and copy the code into MySQL Workbench.

- Go over the bits of code which create "id" and set it as the primary key once more. Make sure everyone understands how this works and explain how useful this will be in this week's homework.

### Ins: Breaking Into the Join

- (10 min)

- Now we are getting into one of the more difficult aspects of MySQL, but tell your class that this information will be very useful to them in the homework should they decide to attempt the challenge assignment.

- Joins allow those using MySQL to combine two or more individual tables together using a value that is shared between them.

- Open up `books.sql` in `05-books` and then copy it into MySQL Workbench. Take a moment to demonstrate the structure of the `books` and `authors` tables.

- Explain that we can utilize joins to combine and display data from both tables. Point out how the `books` table has a foreign key of `authorId` which corresponds to the `id` of a row in the `authors` table. Explain that these tables have what's known as a one-to-many relationship, since a book can only have one author, but an author can have many books.

- Explain that foreign keys are most commonly used to relate tables since primary keys are unique and won't change. Demonstrate each query below, showing students the resulting table, and explaining the differences between each join.

  - INNER JOIN: Combines tables where the specified data-values within a column match one-another

  - LEFT JOIN: Combines tables and shows all of the values of the first table specified while only the values which match on the second side will be shown

  - RIGHT JOIN: Combines tables and shows all of the values of the second table specified while only the values which match on the first table will be shown
