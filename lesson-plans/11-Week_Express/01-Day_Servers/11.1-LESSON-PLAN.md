# 11.1 - Intro to Node Servers

## Overview

In this class, we will provide students with a deep conceptual understanding of server-side code and use vanilla Node.js to create basic servers.

- This class is all about introducing students to the concept of server-side code. Coming into class today, students will have a fairly rudimentary notion of servers. Without your guidance it will be difficult for them to understand how the terminal-side code they've been creating thus far using Node.js fits into the big picture of web development. Today's class is all about filling these conceptual gaps.

- Consistently, in this unit, we'll be relying on an analogy that servers are like "big empty boxes". In this analogy, we fill these boxes with sub-modules or code snippets that enable the server to have the functionality we need. Do your part in using this analogy to provide your students with a visual understanding of how server-side code works.

- Also note that in today's class, we will be introducing students to the plain Node approach for creating servers. Let them know that for today's class understanding the exact syntax is _less_ important than understanding the conceptual picture. You can also let them know that in the next class they will be introduced to Express.js, which will simplify some of the code complexity of today.

## Learning Objectives

- To gain a conceptual understanding of server-side code.

- To learn the fundamentals of building a server using plain Node.js to listen and respond to client-side requests.

### Slides

- 630-55 (25 min)

### Ins: 01-FirstServer

- 655-715 (20 min)

- In this exercise, go through the process of re-creating the server.js file found in `01-FirstServer`. If at all possible, create this server "live" and comment on it as you go.

  - During your commentary be sure to point out how:

  - We incorporated the `http` module. This, in essence, is a package ("small box") which allows our server ("big box") to have the capability of handling http requests and responses. HTTP is package that comes with the standard Node library.

  - We specified a port. This could be anything between 80 and above. In essence, a port is like a portal through which servers and clients communicate. The number itself doesn't matter so much for right now, but later we'll be using port 80 which is the standard port URLs use.

  - We created a function for handling requests and responses and then gave this function to our created server.

  - Finally, we set up the server such that it listens at the PORT specified.

- Once you have completed the code write-up, run the application by typing `node server.js` from the command line. Then visit the URL `localhost:PORT`, where `PORT` is the port you specified in the server file. Point out how this emulates our browser (client) making a request of our localhost (server), and in turn receiving a single string response.

  - Answer any questions that remain for this example before proceeding to the next activity.

### Students Do: 02-Two-Servers

- 715-35 (20 min)

### Ins: Review

- Congratulate the students for having just built their very own web servers!

- Run `02-Two-Servers/Solved/server.js` and demonstrate how the message differs when you visit `http://localhost:7000` vs `http://localhost:7500`.

- Then open the code and explain to students the solution. In offering your solution, be sure to mention that in this example, we effectively created two servers. Each server used a different port, a different listener, and a different function for handling requests.

- Slack a copy of the completed app to the class: `02-Two-Servers/Solved/server.js`.

- Then proceed to the next demo.

### Break

- 735-50 (15 min)

### Ins: Portfolio Server

- 750-805 (15 min)

- In this demonstration, you will be showing students a basic "url parsing" and "routing" example. Remember! Let students know that the exact syntax of this example isn't what's important. (They will be using Express in the next class to do it more simply). However, they should take the time necessary to understand what is happening here at a conceptual level.

- Open the file `server.js` inside of `03-Portfolio`. Run the application using Node.js.

- In discussing the code, point out the following discussion items:

  - The use of the abbreviated terms `req` and `res`, which are short for request and response.

  - The use of the switch-case statement which routes the code to a different function depending on the URL provided.
  - Finally, the way in which we created HTML dynamically and rendered it on the page in each function.

- Slack out the solution when complete.

### Students Do: Discuss Portfolio

- 805-10 (5 min)

- Have students discuss the code with one another before asking them to re-explain it back to you. Tie up any loose ends that may remain.

### Ins: Serving HTML

- 810-35 (15 min)

- In this next activity, we will be using `fs` to read and serve HTML files.

- Open the code for `04-Serving-HTML/server.js` and give students a minute to look it over. Ask them what they think is going to happen when you visit `localhost:80`?

- Run `04-Serving-HTML/server.js` and open `localhost:80` in your browser. It's a website!

- Point out how, in this example, we used the `fs` package to read in the `index.html` file. We then used the node server to output this same file back to the user as a response.

### Students Do: Discuss Serving HTML

- 835-40 (5 min)

- Have students discuss the code with one another before asking them to re-explain it back to you. Tie up any loose ends that may remain.

### Students Do: Serve-Favorites

- 840-910 (30 min)

- Next, run the `server.js` file found in `05-Serve-Favorites/Solved`. Visit each of the routes in that file (i.e. `localhost:8080/food`, `localhost:8080/movies`, etc.). Point out how the contents of the page changes each time.

### Ins: Review

- Open up the `server.js` file found in `05-Serve-Favorites/Solved` and review the code in this example. During your discussion, be sure to point out:

  - How we created the basic skeleton of a Node server (requiring: `http` and the port number)

  - How we set up a listener to initiate the server's handling of requests.

  - Created a function `handleRequest` which takes in a request URL, parses it, then relays the user to the correct page.

    - This solution contains a lot of repeated code. Ask your students if they have any suggestions how we might refactor this. Then open `server-bonus.js` and point out how we implement just one `fs.readFile()` command by passing in a filePath into a `renderHTML` function.

### Ins: Request Methods

- 910-20 (10 min)

- Up until now, students have just been exposed to GET requests. (They may not even realize it yet, but all the URL visits they've made thus far have been GET requests). In this activity, we will very briefly introduce them to other HTTP methods.

- Open `06-Request-Methods/server.js` in your editor.

- Briefly run through the code and explain that this app is going to log the type of request it receives, along with any information that was sent with the request.

- Have students download the application [Postman](https://www.getpostman.com/). If you've never worked with Postman before, it's a simple application interface for performing HTTP request (GET, POST, PUT, DELETE, and more).

- Run the server and use Postman to make different types of requests. Show the students how every time a request is made, it is logged in the server's console.

- Let the students know that the body of Postman requests must be sent in `raw`, and GET requests cannot have a body in Postman

- Alternatively you can use CURL

  - `curl -i -H "Accept: application/json" -X GET -d "firstName=james" http://localhost:8080`
  - `curl -i -H "Accept: application/json" -X POST -d "firstName=james" http://localhost:8080`
  - `curl -i -H "Accept: application/json" -X PUT -d "firstName=james" http://localhost:8080`
  - `curl -i -H "Accept: application/json" -X DELETE -d "firstName=james" http://localhost:8080`

- Slack students a copy of this server code: `06-Request-Methods/server.js`.

- Let students know that we will be fleshing out this concept over the course of the week.

### Ins: Introduce Friend Finder Homework

- 920-25 (5 min)

- Finally, end the class by opening the solution to the Homework (FriendFinder). Run the application using `node server.js` then visit `localhost`. Walk students through the basic gist of the application, describing it as a type of dating application or compatibility test. In essence, the application saves each user's survey responses in the database, then compares the responses against everyone in the database to identify the best match.

- Stress that students should deploy their assignment as early as possible and ask for help if they run into issues. Explain that a non-deployed assignment will take a grade hit and won't help students professionally.

### Small Time Left - Review Class

- 925-30 (5 min)

- Ask:

  - What is a web server?
  - What is the difference between a `request` and a `response`.
  - What are some examples of web servers we use every day?
  - What are the different types of request methods, and how are they used?

- Google Express

### Large Time Left - bonus-1-POST-method

- (20 min)

- In this exercise, students will create a server that will accept `POST` requests.

### BONUS: Review

- (10 min)

- Open up the `server.js` file found in `07-POST-Method/Solved` and go over to the solution with students.

- In your discussion:

  - Lightly discuss the concept of a `POST` route, specifically mentioning how POST routes are effectively endpoints that client-side code can use to send data to the server.

  - If you have time, take a few moments to show students how to test this POST route using POSTMan.
