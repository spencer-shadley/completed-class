# 09.1 Lesson Plan: Introduction to Node.js

## Overview

This lesson introduces Node.js and the concepts of standard library, modules, npm, and package.json. Students will build an interactive command line application that outputs .json files using `fs` and `Inquirer`.

- Ensure that students have [downloaded and installed the LTS version of Node](https://nodejs.org/en/). The version number does not matter, just that it is the LTS version.

### Instructor Do: Introduction to Node.js

- 630-40 (10 min)

  - Open the deck

### Instructor Do: Node Check

- 640-45 (5 min)

- Everyone open a terminal

- We set this up day 1, let's make sure node still works

- type `node` followed by `1+1`

- then `ctrl+C`

### Instructor Do: 01-Ins_Node-Demo

- 645-50 (5 min)

- use node to output in a terminal

- `` ctrl+` `` to open the terminal

- `cmd+shift+C` to copy relative path

- `node index.html`

- Ask: what will happen if I change it to `console.log(2+2)`?

### Students Do: 02-Stu_Hello-Node

- 650-55 (5 min)

- students do the same simple app

- bonus is figuring out how to debug - show how to run and debug in vs code (F5 is shortcut to debug)

### Instructor Do: Review

- 655-7 (5 min)

- runtime environment is different than the browser (we are in a node environment)

  - nearly the same as browser but we do not have a "window" or ability to open a "prompt"

  - ask: what else do you think would be different?

### Instructor Do: 03-Ins_process.argv

- 7-05 (5 min)

- demo of command arguments with `process.argv`

- debug and highlight `process.argv` (v = vector) (remember as values)

- arguments are:

  - patah of installation to node
  - absolute path to file

- add the below and run `node index.js 4`:

```js
// arguments passed from the command line are accessed by index
console.log(process.argv[2]);
```

- Run:

  - `node index.js Hello`

  - `node index.js Hello World!`

  - `node index.js "Hello World!"`

- ask: why do we care?
  - dynamic and interactive applications (this is a CLI just like we had interfaces for the web)

### Students Do: 04-Stu_Parameter-Check

- 705-15 (10 min)

### Instructor Do: Review

- 715-20 (5 min)

  - Values stored in `process.argv` are accessed by array index

  - There are multiple solutiosn for any problem

- Navigate to [04-Stu_Parameter-Check/Solved] and run the following commands to demonstrate functionality of the application:

  - `node index.js 3 4`

  - `node index.js 7 7`

- Open [04-Stu_Parameter-Check/Solved/index.js] and explain the following:

  - We store the argument values stored in the process object in two variables:

  ```js
  var a = process.argv[2];
  var b = process.argv[3];
  ```

  - We check the parameters using four different methods:

  ```js
  // using a conditional statement
  if (a === b) {
    console.log(true);
  } else {
    console.log(false);
  }

  //using a ternary operator
  console.log(a === b ? true : false);

  // comparing variables
  console.log(a === b);

  // comparing argument values directly
  console.log(process.argv[2] === process.argv[3]);
  ```

### Instructor Do: Reading Files

- 720-25 (5 min)

  - Importing modules using `require`

  - Reading files with `fs`

- Open [05-Ins_readFile/index.js] and explain the following points:

  - When we installed Node.js, we also installed its **standard library**. The standard library includes dozens of **modules** that extend the basic functionality of Node.

  - In order to use a modules, we need to _import_ it into our application using `require`:

  - We import the `fs`, or **file system** module using require and store it in a variable, `fs`.

  - The convention is to name variables after the module.

  - What do you think this application does?

  - This application will _read a file_, `data.csv`, and will log the results stored in a variable, `data`.

  - The `fs` method `readFile` accepts three arguments: 1. the file we want to read, the encoding format we want to use to read the file, and a callback.

  - `"utf8"` is an encoding format that converts raw data into human-readable text.

  - If we want to learn more about `utf8`, we can read the [Node documentation for readFile](https://nodejs.org/api/fs.html#fs_fs_readfile_path_options_callback) and the [Wikipedia article on character encoding](https://en.wikipedia.org/wiki/Character_encoding).

  - Why do you think we need to import modules if they are built-in to Node to begin with?

  - We import modules into our application so that we are only loading exactly what we need. This will speed up the performance of our applications.

- Run [05-Ins_readFile] from the command line and run `node index.js`. The results will be similar to:

```sh
10,123,76,5003,9,0.127,40,-1,2^4
```

- Edit `data.csv` to demonstrate that Node is in fact reading the file.

  - If we can _read_ files with Node, what else do you think we can do?

- Use student answers to transition to the next demo.

### Instructor Do: Writing Files

- 725-30 (5 min)

* Use the prompts and talking points below to demonstrate the following key point(s):

  - The `fs.writeFile` method will generate non-existent files

  - The `fs.writeFile` method will overwrite a file

* Open [06-Ins_writeFile] in your IDE and explain the following:

  - We again import file system from our standard library.

  ```js
  var fs = require('fs');
  ```

  - Our code is similar, but different from the previous demo:

  ```js
  fs.writeFile('log.txt', process.argv[2], function(err) {
    if (err) {
      return console.log(err);
    }

    console.log('Success!');
  });
  ```

  - There is no `.txt` file in the `06-Ins_writeFile` directory.

  - What is different about this example?

  - Rather than `readFile`, we are using the `fs` method `writeFile`. Rather than specifying an encoding format, our second argument is `process.argv[2]`.

* Run the following command from the command line:

```sh
node index.js Hello
```

- Open the newly created `log.txt` and point out the following:

  - Running our application created a new file, and wrote the text 'Hello' to it.

- Run the following command:

```sh
node index.js World!
```

- Open `log.txt` and point out the following:

  - Running our application wrote the text 'World!' to `log.txt`.

  - What happens when we run our application multiple times?

  - `writeFile` overwrites existing files.

  - How do we think we can resolve this issue?

  - We need a method that can _append_ text to files.

### 11. Students Do: 07-Stu_appendFile

- 730-40 (10 min)

### 12. Instructor Do: Review

- 740-45 (5 min)

  - `appendFile` appends text to file rather than overwriting the file

- Run [07-Stu_appendFile/Solved/index.js] from the command line to demonstrate the application functionality, entering commands similar to the following:

```sh
node index.js "first"
node index.js "commit early and often"
node index.js "everyone wants a log"
```

- Open `07-Stu_appendFile/log.txt` and point out the following:

  - Our application is now adding text to our file rather than overwriting the file.

- Open [07-Stu_appendFile/Solved/index.js] and explain the following:

  - Our application is very similar to the previous demo, but here we have refactored it to use `appendFile` rather than `writeFile`:

  ```js
  fs.appendFile('log.txt', process.argv[2] + '\n', function(err) {
    if (err) {
      console.log(err);
    } else {
      console.log('Commit logged!');
    }
  });
  ```

  - We concatenate a new line character, `\n`, to the value stored in `process.argv[2]`.

  - How did you find the solution to this activity?"

  - The solution can be easily found by searching for, and reading, the [Node.js documentation for the File System module](https://nodejs.org/api/fs.html#fs_fs_appendfile_path_data_options_callback).

### Instructor Do: Modularization Using Require/Exports

- 745-50 (5 min)

- The Node.js standard library modules are _also_ written in JavaScript

- `module.exports`

- Navigate to the [Node.js source code for `fs`](https://github.com/nodejs/node/blob/master/lib/fs.js) in your browser. Find (CTRL + F) `appendFile` and point out the following:

  - `appendFile` is a function written in JavaScript. It even uses `fs.writeFile`!

  ```js
  function appendFile(path, data, options, callback) {
    callback = maybeCallback(callback || options);
    options = getOptions(options, { encoding: 'utf8', mode: 0o666, flag: 'a' });

    // Don't make changes directly on options object
    options = copyObject(options);

    // Force append behavior when using a supplied file descriptor
    if (!options.flag || isFd(path)) options.flag = 'a';

    fs.writeFile(path, data, options, callback);
  }
  ```

  - How would we extend the functionality of Node?'

  - We could write our own modules!

- Run [08-Ins_Modularization/index.js] from the command line. The output will be the following:

```sh
apple
1
```

- Open [08-Ins_Modularization/index.js] in your IDE and explain the following:

  - We are importing a dependency, `badmath`, and logging the results of `badmath.pie` and `badmath.predictable`.

  ```js
  var badmath = require('./badmath.js');

  console.log(badmath.pie);

  console.log(badmath.predictable());
  ```

- Open [08-Ins_Modularization/badmath.js] and explain the following:

  - We declare a `pie` and `predictable` variables:

  ```js
  var pie = 'apple';

  var predictable = function() {
    return 1;
  };
  ```

  - We _export_ our `pie` and `predictable` variables as an object stored in `module.exports`:

  ```js
  module.exports = {
    pie: pie,
    predictable: predictable
  };
  ```

  - If we want to learn more, we can read about it in the [module.exports documentation](https://nodejs.org/api/modules.html#modules_module_exports)

  - What is referenced by the keyword **module**?'

  - Our file, `badmath.js`.

### Students Do: 09-Stu_maths-Module

- 750-8 (10 min)

### BREAK

- 8-15

- (15 min)

### Instructor Do: Review

- 815-20 (5 min)

- Direct export of a module

```sh
node index.js sum 3 4
node index.js difference 3 4
node index.js product 3 4
node index.js quotient 3 4
```

- Open [09-Stu_maths-Module/Solved/index.js] in your IDE and explain the following:

  - We import our `maths` module and declare three variables, `operation`, `numOne` and `numTwo` to store the values passed to `process.argv` from the command line:

  - We use `parseInt()` to cast the values from strings to numbers.

  - We use a `switch` statement to evaluate the `operation` case and call the corresponding method from our `maths` module:

- Open [09-Stu_maths-Module/Solved/maths.js] and explain the following:

  - We export our maths methods directly by declaring them within the `exports` object:

  - Each method accepts two parameters and returns the corresponding value.

### Instructor Do: npm

- 820-30 (10 min)

  - npmjs.com

  - `npm install <package-name>`

  - `node_modules`

  - `package.json`

  - What if we wanted to share our module with other developers?

  - We _could_ host our module on GitHub, JSFiddle or Codepen. We could also compress and share our files via email or Slack.

  - What would be the downside to these approaches?

  - It would be difficult for other developers to find our module and would require them to clone the GitHub repository, or copy/paste the source code, or keep track of the compressed file. If one developer updates the module, then everyone elses' code go out of sync and requires a transfer of files again.

- Run [10-Ins_npm/index.js] from the command line and point out the following:

  - Our application throws an error when we run it.

  ```sh
  Error: Cannot find module 'badmath'
  ```

  - Why is this application throwing an error?

  - Our `badmath` module is missing!

- Navigate to [npmjs.com](https://www.npmjs.com) and search for "badmath", then navigate to the [badmath package registry](https://www.npmjs.com/package/badmath).

  - Do we see a solution to our missing module problem?

  - Our `badmath` module is hosted on [npmjs.com](https://www.npmjs.com). We see from the documentation that we can install the module by running the following command:

  ```sh
  npm i badmath
  ```

  - What is **npm**?

  - `npm` is short for **Node Package Manager**. It is both a command line utility _and_ a databse of packages. We can learn more about npm on the [npm About page](https://docs.npmjs.com/about-npm/).

  - What is the `i` in `npm i badmath`?

  - The `i` is short for install. When we run `npm i badmath` from the command line, we install the `badmath` module in our application. We can also use the full word, `install`, so, for example: `npm install badmath`.

- Run `npm i badmath` from the command line and explain the following:

  - We see a progress meter when we install packages, a few warnings, and a successful install message:

  - We must be in the working directory to install modules.

- Run [10-Ins_npm/index.js] from the command line and point out the following:

  - Our application now logs the expected values:

  ```sh
  apple
  1
  ```

- Open the [10-Ins_npm] directory and point out the following:

  - Running `npm i badmath` created a `package-lock.json` file and a `node_modules` directory.

  - The `package-lock.json` file is for keeping track of precise versions of all third-party libraries used in a project. This will be generated and updated for us automatically and we can ignore it for the most part.

  - What do we think we will find in the `node_modules` directory?

  - When we open the `node_modules` directory we find a `badmath` directory. If we open the `badmath` directory, we find `index.js`.

  - What do expect to find in `index.js`?

  - Our bad math!

- Open your generated `package.json` file in [10-Ins_npm] in your IDE and explain the following:

  - The `package.json` file contains metadata about our module. These files serve as manifests (or guides) that completely articulate simple things like the name of the project, its description, and most importantly the packages that are being used in the project.

- Ask the class, 'How might a `package.json` file be useful in our own applications?'

- Use student answers to transition to the next activity.

### Student Do: 11-Stu_package.json

- 830-35 (5 min)

### Instuctor Do: Review

- 835-40 (5 min)

* Use the prompts and talking points below to review the following key point(s):

  - `npm install`

  - Dependency dependencies

* Navigate to [11-Stu_package.json] and run the following command:

```
npm install
```

- Open the [11-Stu_package.json] directory and point out the following:

  - Running `npm install` created a `node_modules` directory.

  - If we open the `node_modules` directory, we see that several packages were installed.

  - Where did all of these packages come from?

  - When we run `npm install`, `npm` "reads" our `package.json` file and installs our application dependencies.

- Open [11-Stu_package.json] and point out the following:

  - `inquirer` is listed under `"dependencies"` in our `package.json` file.

- Open the generated `node_modules` folder inside of [11-Stu_package.json] and point out the following:

  - Our `inquirer` package was installed as well as a several others.

  - Why did `npm` install more than just `inquirer`?

  - The additional packages are dependencies of `inquirer`.

- Open the generated `node_modules/inquirer/package.json` file inside of [11-Stu_package.json] and point out the following:

  - Our dependency `inquirer` has quite a few of its own dependencies!

  - How would we create our own `package.json` files?

  - We _could_ write our own manually, but there's an easier way!

### Instructor Do: 12-Ins_npm-init

- 840-45 (5 min)

* Use the prompts and talking points below to demonstrate the following key point(s):

  - `npm init`

  - `npm install --save <package-name>`

  - This is the same 'application' from earlier demo, importing `badmath` and logging two values.

```sh
npm init
```

- What is `init` short for?

- `npm init` is the command we use to _initialize_ a Node.js project

- Use the command prompts to generate a `package.json` file and explain the following:

  - `npm init` initializes a Node.js project with a `package.json` file

  - We first provide a package name. `npm` _reads_ the directory name and suggests it as the default value. We can select the default value by pressing Enter.

  ```sh
  This utility will walk you through creating a package.json file.
  It only covers the most common items, and tries to guess sensible defaults.

  See `npm help json` for definitive documentation on these fields
  and exactly what they do.

  Use `npm install <pkg>` afterwards to install a package and
  save it as a dependency in the package.json file.

  Press ^C at any time to quit.
  package name: (12-ins_npm-init)
  ```

  - `npm` will next prompt us for a version number. We'll accept the default value.

  ```sh
  version: (1.0.0)
  ```

  - `npm` will next prompt us for a description. We want to be detailed with our description to help our collaborators (and future selves!) understand the application.

  ```sh
  description: Demonstration of initializing a Node.js application with npm.
  ```

  - `npm` will next prompt us for an entry point. `npm` will first look for an `index.js` file, which is the default and standard for Node applications. If it doesn't find one, it will suggest another file.

  ```sh
  entry point: (index.js)
  ```

  - `npm` will next prompt us for a test command. We'll learn more about this later, so we'll leave it blank for the time being.

  ```sh
  test command:
  ```

  - `npm` will next prompt us for a the URL to the GitHub repository where this application will be hosted:

  ```sh
  git repository: https://github.com/nielsenjared/badmath
  ```

  - `npm` will next prompt us for keywords. Keywords help other developers find our module on GitHub and npmjs.com:

  ```sh
  keywords:
  ```

  - `npm` will next prompt us for an author.

  ```sh
  author: Dr. Seuss
  ```

  - `npm` will prompt us for a license. The default value is `ISC`, an open source, "as is" license.

  ```sh
  license: (ISC)
  ```

  - If we want to learn more about ISC, we can read about it at the [Open Source Initiative](https://opensource.org/licenses/ISC). We can specifiy any license we want. If we want to learn more about software licenses, we can review our options on the [GitHub Help page for Licensing a repository](https://help.github.com/en/articles/licensing-a-repository)

  - Lastly, `npm` will display the results of our input and prompt us with the following:

  - When we press Enter and accept the default, `(yes)`, our `package.json` file is created.

  - `npm` automatically generated a "bugs" property and the "url" points to the Issues associated with our GitHub repository.

  - `npm` automatically generated a "homepage" property and the value is the README of our GitHub repository.

  - If we want to learn more about `npm init`, we can read the [npmjs.com documentation on creating a package.json file](https://docs.npmjs.com/creating-a-package-json-file)

  - But how do we add dependencies to our `package.json` file?

  - We _could_ edit the `package.json` file manually. Or we could use a **flag** to instruct `npm` to add it for us.

- Run the following command from the command line:

```sh
npm install badmath --save
```

- Open [12-Ins_npm-init/package.json] and point out the following:

  - Using the `--save` flag when installing a module _saves_ it to our `package.json` file as a dependency.

### Students Do: 13-Stu_npm-init

- 845-50 (5 min)

### Instructor Do: Review

- 850-55 (5 min)

  - `npm init -y` generates a `package.json` file with default values

  - `npm install --save` installs a module as a dependency in our `package.json` file

  - `npm install --save-dev <package-name>` installs a module as a development dependency in our `package.json` file

  - `npm install -g <package-name>` installs a module globally

  - `npm uninstall` uninstalls a module. It can be combined with `-g`, `--save` and `--save-dev`.

  - What does `npm init -y` do?

  - Using the `-y`, or "yes", flag with `npm init` accepts all default options and leaves optional fields blank.

* Run `npm init -y` from the command line and point out the following:

  - `npm init -y` accepts the default options and automagically generates a `package.json` file for us.

  - `npm` does _not_ prompt us for details about our module.

  - How do we add dependencies, such as `inquirer`, to our `package.json`?

  - We use the `--save` flag with `npm install`, so, `npm install --save inquirer`

  - What does `--save-dev` do?

  - `--save-dev` installs a package as a development dependency. This is for packages that are only used locally, but won't be required when the application is deployed.

  - What does the `-g` flag do when running `npm install`?

  - The `-g`, or global, flag installs an npm package _globally_, meaning we can use it from any directory on our computer. By default, npm installs _locally_, or within the working directory where the command is run.

  - Why would we _not_ want to install our dependencies globally by default?

  - To ensure that our applications are using the correct version of a package.

  - What are examples of packages we _would_ want to install globally?

  - Developer tools that are not dependencies in our application code base.

* Run `npm install -g jshint` from the command line and explain the following:

  - We installed `jshint` globally using the `-g` flag, meaning we can use this package in any Node application.

  - How would we _uninstall_ a package?

  - We use the command `npm uninstall` with the package name and how we want to uninstall it, i.e: a dependency (`--save`), a dev dependency (`--save-dev`) or globally (`-g`).

* Run `npm uninstall -g jshint` from the command line and explain the following:

  - We uninstalled the `jshint` package globally using `npm uninstall -g`

  - If we want to learn more about the options available to us, we can read about them in the [`npm-install` documentation](https://docs.npmjs.com/cli/install).

### Instructor Do: 14-Ins_Inquirer-Demo

- 855-9 (5 min)

  - The `inquirer.prompt` method accepts an array of objects, each with `type`, `name` and `message` properties.

  - The results of the `prompt` method are passed in an object as the callback parameter, `response`, in the Promise chain

- Ask the class:

  - What do we think this `inquirer` package does?

  - Based on the dictionary definition of _inquire_, it might be used to ask for information from someone, that someone being the user of our application.

- Navigate to [14-Ins_Inquirer-Demo] and install dependencies using:

  - `npm install`

- Run [14-Ins_Inquirer-Demo/index.js] from the command line and explain the following:

  - Our application prompts us for a user name, a password and a confirmation.

  - If the passwords match, the application logs "Success!".

- Open [14-Ins_Inquirer-Demo] in your IDE and explain the following:

  - We require our `inquirer` dependency.

  - We use the `prompt` method to _prompt_ users for input.

  - Our prompts are an array of objects with `type`, `message` and `name` properties. The input of each prompt will be stored in an object property that corresponds to the `name` value. The `type` values are built in to `inquirer` and what allows us to enter _secure_ passwords.

  - The `message` property in each object corresponds with the prompt we saw at the command line.

  - Once all of the prompts are answered, we can _then_ work with the user `response`. Here, the `response` parameter in the `.then` callback corresponds with the user input, which `inquirer` store in an object.

  ```js
    .then(function(response) {

      if (response.confirm === response.password) {
        console.log("Success!");
      }
      else {
        console.log("You forgot your password already?!");
      }
    });
  ```

  - We _validate_ the users' password with a conditional statement, checking if `response.confirm` if equal to `response.password`. If so, we return "Success!". If not, "You forgot your password already?"

  - If we want to learn more, we can read the [`inquirer` documentation](https://www.npmjs.com/package/inquirer)

### Students Do: 15-Stu_Inquirer-Users

- 9-20 (20 min)

- Run [15-Stu_Inquirer-Users/Solved/index.js] from the command line to demonstrate the application functionality and point out the following:

  - We are prompted for our name.

  - We are then prompted for the langauges we know. Using the space bar, we can select multiple options.

  - We are prompted for our preferred method of communication. Unlike the previous prompt, we can only select one option.

  - After all prompts are entered, a `json` file is created from the name we entered at the prompt, for example: `adalovelace.json`

### Instructor Do: Review

- 920-25 (5 min)

  - Our application requires two dependencies, one third-party (`inquirer`) the other standard library (`fs`).

  - We use two new `type` properties to prompt our user for a `"checkbox"` and a `"list"`, both of which require a `choices` property and a corresponding array of options.

  - We use the `JSON.stringify` optional `replacer` (`null`) and `space` (`\t`) parameters to format our `data` object with pretty-print appearance.

- Open [15-Stu_Inquirer-Users/index.js] in your IDE and explain the following:

  - Our application requires two dependencies, one third-party (`inquirer`) the other standard library (`fs`).

  ```js
  var inquirer = require('inquirer');
  var fs = require('fs');
  ```

  - We use two new `type` properties to prompt our user for a `"checkbox"` and a `"list"`, both of which require a `choices` property and a corresponding array of options.

  - We pass the output of the `prompt` method to our Promise callback as `data`.

  - We named this parameter `response` in the demo, but we can call it anything, as long as it follows best-practices and is descriptive.

  - We create a `filename` variable by converting the value in `data.name` to lowercase, removing any spaces using `split(' ')` and then joining the split values back together without spaces using `.join('')`. We concatenate this value with `".json"` to add a file extension.

  - We use the `fs.writeFile` method to create a new file using our `filename` variable. We use the `JSON.stringify` optional `replacer` (`null`) and `space` (`\t`) parameters to format our `data` object with pretty-print appearance.
