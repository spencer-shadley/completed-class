# 17.1 - Masters of MongoDB

## Overview

In this class, you will introduce the concept of the NoSQL database with MongoDB, go over its pros and cons compared with MySQL, and ultimately detail all of the required steps to employ MongoDB in future projects.

## Learning Objectives

- Identify and explain the differences between SQL and noSQL databases.

- Install MongoDB and Robo 3T.

- Create a Mongo database.

- Perform basic CRUD actions on their Mongo database.

### Ins: Slides

- 630-40 (10 min)

### 00-Stu-Install-MongoDB

- 640-7 (20 min)

- demo running `mongod`

  - tell them this starts a daemon in the background to handle mongo requests

- run `mongo` to start the mongo shell which connects to `mongod`

- Show Robo 3T

- look at activity 0 for installation instructions

### Ins: 01-Ins-Create-Insert-and-Find

- 7-20 (20 min)

- feel free to follow along

- we're going to use all the CRUD operations for mongo

- now that we know CRUD, it's really just translation

- run `cd C:`, `mongod` and then `mongo`

- `db` (show we default to `test` db)

- `use farm`

- `show dbs` (doesn't create stuff until we insert data)

- ```js
  db.animals.insert({
    name: 'spot',
    species: 'cow',
    food: ['grass', 'hay']
  });
  ```

- ask: tell me how to insert another animal

- `db.animals.find()`

  - NOTE: the MongoDB `_id` was created automatically.

- Add `.pretty()`

- `db.animals.find({ species: 'cow' })`

- `db.animals.find({_id: ObjectId("someId")})`

- `db.animals.update({ name: 'spot' }, { name: 'Speckle' });`

- `db.animals.update({ name: 'Speckle' }, { $set: { sound: 'moo!' } });`

- `db.animals.remove({ name: 'Speckle' });`

- `db.animals.drop();`

### Stu: 02-Create-Insert-and-Find

- 720-30 (10 min)

- try out the CRUD operations

### Ins: Review

- 730-45 (15 min)

- split screen terminal and `README.md`

  ```js
  use classroom
  db.students.insert({name: 'Spencer', os:'Win', favoriteColor: 'blue', hobbies:['Coding', 'Programming'] })
  ```

- Find everyone

  - `db.students.find()`

- Find a person by name

  - `db.students.find({name: 'Spencer'})`

- All Windows users

  - `db.students.find({os: 'Win'})`

- Find a person who uses windows and has a favorite color of blue

  - `db.students.find({os: 'Win', favoriteColor: 'blue'})`

- Delete all mac users

  `db.students.remove({ os: 'Mac' });`

- BONUS - operators

- Find by entry in an array

  ```js
  db.students.find({ hobbies: { $in: ['Coding'] } });
  ```

- Update the "name" field to a nickname (show that without set this just replaces the entry)

  - `db.students.update({name: 'spencer'}, {$set: {name: 'Spence'}})`

- Add a new hobby

  ```js
  db.students.update({ name: 'Spencer' }, { $push: { hobbies: 'Developing' } });
  ```

- Drop the students collection

  - `show collections`
  - `db.students.drop()`
  - `show collections`

- Drop the database

  - `db.dropDatabase()`

### Ins: 03-Ins-Operators

- 745-45 (00 min)

- can skip this, combined with above

TODO: left off here

```js
use farm
```

- `$set`

  - Want to add "sound" to cow - show that update just replaces it

  - `db.animals.update({species: 'cow'}, {sound: 'moo!'})`

  - instead use `db.animals.update({species: 'cow'}, {$set: {sound: 'moo!'}})`

- We use `push` to update values in an array.

- We use `drop` to drop a collection.

### Stu: 04-Stu-Operators

- 745-8 (15 min)

- Try out these operators

### Ins: Review

- (5 min)

* Open [04-Stu-Update-Delete-and-Drop/Solved/README.md] in your IDE and walk students through the queries.

* Go back to your classroom database.

  ```sql
  db
  use classroom
  ```

* You've decided to take on a new hobby. Add Extreme Basketweaving to your array of hobbies.

  ```sql
  db.students.update({name: "Steve"}, {$push: {"hobbies":"Extreme Basket weaving"}})
  ```

* While practicing for your Extreme Basket weaving Competition, you broke the computer of the person next to you. They're using a new Operating System now. Change their os field.

  ```sql
  db.students.update({name: [name of neighbor]}, {$set: {os:[name of another os]}})
  ```

* Another student in your row saw you break that computer and wisely decided to move. Remove them from your database.

  ```sql
  db.students.remove({name: [name of another neighbor]})
  ```

* You are worried everyone else will leave and you'll have to sit all alone. You decide to bribe everyone who didn't leave with candy. Add a field of `gavecandy` with a value of false to everyone in the array so you can keep track.

  ```sql
  db.students.update({}, {$set: {gavecandy:false}}, {multi:true})
  ```

* All this work made you hungry, so you bought yourself some candy. Change the value of `gavecandy` to `true` in your entry.

  ```sql
  db.students.update({name:'Steve'}, {$set: {gavecandy:true}})
  ```

## Bonus

- Insert five more documents with one command.

  ```sql
  db.students.insertMany([
    {name: 'Jane', row:1, os:'Mac', hobbies:['Coding', 'Sleeping', 'Karate'] },
    {name: 'Mary', row:2, os:'Mac', hobbies:['Baseball', 'Basketball', 'Tai Chi'] },
    {name: 'Alexis', row:3, os:'Lin', hobbies:['Gaming', 'Reading', 'Gardening'] },
    {name: 'Gary', row:4, os:'Mac', hobbies:['Walking', 'Reading', 'Mountain Climbing'] },
    {name: 'Ed', row:5, os:'Win', hobbies:['Coding', 'Karate', 'Scuba Diving'] }
  ]);
  ```

- Return all documents of students who have reading as a hobby or a mac operating system.

  ```sql
  db.students.find(
      {$or:[
          {"hobbies":{"$in":["Reading"]}},
          {"os":{"$in":["mac"]}}
      ]}
  )
  ```

- Ask the students the following question(s):

  - What does the `$push` method do?

  - It updates the values in an array, `db.places.update({"country": "Morocco"}, {$push: {"majorcities": "Agadir"}})`

  - Which method deletes an entry from a collection?

  - We can use remove, `db.[COLLECTION_NAME].remove()`

### BREAK

- (15 min)

### Ins: Sorting in MongoDB

- (10 min)

  - MongoDB has a way to sort results just like MySQL.

- We can sort by `integer`, `_id` and `class`.

- Tell the students to create a new db named `zoo` and insert 10 animals with the following attributes:

  - `numLegs` an integer that points to the number of legs.

  - `class` as string that points to the animal's class ("reptile", "mammal" etc).

  - `weight` an integer that points to the animals weight.

  - `name` a string that points to the animal's name.

- Example:

  ```js
  {
    "name": "Panda",
    "numLegs": 4,
    "class": "mammal",
    "weight": 254
  }

    db.animals.insert({"name":"Panda", "numLegs":4, "class":"mammal", "weight": 254, "whatIWouldReallyCallIt":"Captain Fuzzy Face"});
    db.animals.insert({"name":"Dog", "numLegs":4, "class":"mammal", "weight": 60, "whatIWouldReallyCallIt":"Captain Fuzzy Face II"});
    db.animals.insert({"name":"Ostrich", "numLegs":2, "class":"aves", "weight": 230, "whatIWouldReallyCallIt":"Steve"});
    db.animals.insert({"name":"Kangaroo", "numLegs":2, "class":"marsupial", "weight": 200, "whatIWouldReallyCallIt":"Bouncer"});
    db.animals.insert({"name":"Chameleon", "numLegs":4, "class":"reptile", "weight": 5, "whatIWouldReallyCallIt":"Scales"});
  ```

- Open [05-Ins-Sorting-In-Mongo/README.md] in your IDE and demonstrate some of the most common ways we sort using MongoDB.

- In the mongo shell, run the following commands one at a time having students follow along.

- **Sort by id:**

- The id contains a timestamp, so sorting by id will sort by when they were entered to the database.

  - Explain that a value of `1` is for ascending order and `-1` is for descending order.

```sql
db.animals.find().sort({ _id:1 });
db.animals.find().sort({ _id:-1 });
```

- **Sort by an integer - numLegs:**

```sql
db.animals.find().sort({ numLegs:1 });
db.animals.find().sort({ numLegs:-1 });
```

- **Sort by a string - class:**

```sql
db.animals.find().sort({ class:1 });
db.animals.find().sort({ class:-1 });
```

### Ins: Introduction to MongoJS

- (10 min)

- Tell the class that now that they have an understanding of how MongoDB works we are going to dive into MongoJS.

- MongoJS wraps `mongodb-native` and emulates the official MongoDB API.

  - We are going to use this to interact with our Node.JS applications.

- Ask the students the following question(s):

  - What does the `sort` method use to determine what order to put records in?

  - The `timestamp`.

    - MongoJS wraps `mongodb-native` and emulates the official MongoDB API.

- Have the students visit [MongoJS](https://www.npmjs.com/package/mongojs) in their browser.

- Ask for a volunteer to guess how you might use `MongoJS`: `find`, `insert`, `remove` and `sort`.

- These methods are nearly identical to running them in the `mongo` shell so they will feel comfortable with MongoJS.

- Tell the class not to worry if they are confused, they will get plenty of practice moving forward.

### Stu: MongoJS Sorting

- (15 min)

- Open [06-Stu-MongoJS-Sorting/Solved/server.js] solution on your machine, and run `server.js` with Node.

- Visit the different routes in your web browser to show students the results:

  - `/` will display a simple hello world message.
  - `/all` will display JSON with every animal in your zoo collection.
  - `/name` will display JSON with every animal, sorted by name.
  - `/weight` will display JSON with every animal, sorted by weight.

- Next direct students towards the unsolved version located in [06-Stu-MongoJS-Sorting/Unsolved/server.js] and have them complete the activity.

# Instructions

- Create four routes that display results from your zoo collection

  - 0: Root: Displays a simple "Hello World" message (no mongo required).
  - 1: All: Send JSON response with all animals
  - 2: Name: Send JSON response sorted by name in ascending order
  - 3: Weight: Send JSON response sorted by weight in descending order

- Tell your students to ask you or a TA for help if they have any questions while working on the assignment.

### Ins: Review

- (5 min)

- Ask the students how the activity went, and encourage anyone who had trouble using it.

- Remember, even if it is similar to using the `mongo` shell, this is still the first time they've used this node package.

- Open [06-Stu-MongoJS-Sorting/Unsolved/server.js] on your machine and ask for volunteers to help guide you through the activity.

- After each route, start the `server.js` file and use your web browser to check the route.

- If it works, great! If not, ask the student who gave the answer if you had mistyped something (since they gave the answer they'll probably be able to point out the error better than anyone).

### Stu: MongoJS CRUD

- (20 min)

- Open [07-Stu-Mongo-CRUD/Solved/server.js] on your machine and demonstrate the solved version of the app by creating, updating and deleting a few notes.

  - Note that to update a note you have to click on it's title, then update the form and submit.

- After demoing, direct students to the unsolved activity located in [07-Stu-Mongo-CRUD/Unsolved/server.js]

# Instructions

- Update the [server.js](Unsolved/server.js) file to include the following six routes.

- You can see a list of methods available to you here. [https: github.com/mafintosh/mongojs#api](https://github.com/mafintosh/mongojs#api).

- Save a note to the database's collection `POST: /submit`

- Retrieve all notes from the database's collection `GET: /all`

- Retrieve one note in the database's collection by it's ObjectId `GET: /find/:id`

- Update one note in the database's collection by it's ObjectId `POST: /update/:id`

- Delete one note from the database's collection by it's ObjectId `DELETE: /delete/:id`

- Clear the entire note collection `DELETE: /clearall`

### Ins: Review

- (10 min)

- Open [07-Stu-Mongo-CRUD/Solved/server.js] and walk students through the code.

### Ins: Demonstrate Robo 3T

- (5 min)

- Instruct your students to open the application. They should see a window like this:

  - They should hit the connect button. Do the same to show students what comes next.

  - `/all` will display JSON with every animal in your zoo collection.

  - `/name` will display JSON with every animal, sorted by name.

  - `/weight` will display JSON with every animal, sorted by weight.

### Stu: Robot 3T Practice

- (5 min)

- Instruct students to drop their classroom collection and create a new one.

# Instructions

- ONLY USE ROBO 3T FOR THIS ASSIGNMENT

- In a new classroom collection, re-enter your `name`, `os`, and `hobby` info array.

  - This should be entered using the `right-click -> Insert Object` method.

- Next, Slack out your `name`, `os` and `hobbies` into the classroom chat.

- As students enter their BSON info into slack, insert it into your database.

- By the end of the exercise, you should have every student's information in your classroom collection.

- Direct students to the next activity located in [08-Stu-Robo-3T].

```md
# Robot 3T

- In this activity, you will practice using Robo 3T.

## Instructions

- Drop your classroom collection and create a new one.

- In a new classroom collection, re-enter your `name`, `os`, and `hobby` info array.

  - This should be entered using the `right-click -> Insert Object` method.

- Next, Slack out your `name`, `os` and `hobbies` into the classroom chat.

- As students enter their BSON info into slack, insert it into your database.

- By the end of the exercise, you should have every student's information in your classroom collection.
```
