# 4.2 Lesson Plan - Events Extravaganza (6:30 PM)

## Overview

In this class, we will further students' understanding of DOM Manipulation using events. Towards the end of class, we will create an activity that dynamically creates modals for each item in a list.

## Instructor Notes

* `Summary: Complete activities 10-19 in Unit 04`

* Today's class is focused on providing students with additional exposure to the DOM, this time focusing on events. The primary focus of today should be to ensure that students feel comfortable setting up click listeners and using their callbacks to manipulate the DOM.

## Learning Objectives

* By the end of class students will be able to:

  * To use event listeners such as click, keydown, and change.

  * Prevent default form behavior with `event.preventDefault()`.

  * Stop the propagation of events. 

  * Dynamically generate DOM elements whose events are delegated.

- - -

## Class Instruction

### 1. Instructor Do: Welcome Students (5 min)

6:30-35

* Today we'll be learning about how to handle user actions

* First a few points

    * I know the course can be frustrating. Remember in the first day when I said learning can feel a lot like frustration?

    * Think about where you are right now. How much have you learned since just a few weeks ago when we started? Many of you didn't know how to create a directory, file or use the command prompt.

    * Now you can create a web app. That web app is responsive, dynamic, handles user input, live on the Internet and more. You know tools to share code - loops, arrays, etc.

    * That's a lot. It hasn't even been a month. Stop and celebrate that. You're grown a lot and are capable of programming something so much more powerful than you were just a month ago.

    * Remember that this course does take a lot of work to keep doing such rapid growth. We recommend 20-30 hours per week _oustide_ of class. Go through the activities, do the homework, get into study groups, remember to pseudocode.

    * Any questions before we start?

* Open [fs-ground-04-web-APIs-event-demo](https://coding-boot-camp.github.io/fs-ground-04-web-APIs-event-demo/) and demonstrate the application functionality:

  * We can add people to the list.
  
  * Clicking `edit` next to any name opens a modal.

  * We can add details about the person and `save` the data.

  * We can return to any person on the list, and see that the details are still there. 

  * 📝 Our form is not routing us to a new page! How?

* Ask the class the following question(s):

  * "How would we build this application?"

  * Use student answers to transition to the next activity.

### 2. Instructor Do: Pseudocode Modal Demo (10 min)

6:35-45

* Open a new (blank) file in your IDE and lead students in outlining the steps to build the modal activity in pseudocode. Refer to the following pseudocode example. There is no one *right* solution. The purpose of this activity is to reinforce problem solving strategies and prepare students for technical interview questions.

* Ask the class the following question(s):

  * "What is the first thing our app needs so a user can add another user to the list?"

  * We need an input field for `name`.

  * We need some way to gather the data from `name` when `Add Person` is pressed.

* Ask the class the following question(s):

  * "When a user adds a new user to the HTML form and clicks `Add Person`, what happens next?"

  * We need to dynamically create a new list item.

  * We append an `edit` button to that new list item.

  * Then we append the new list item to the main people list.

* Ask the class the following question(s):

  * "What needs to happen when a user clicks the "edit" button?"

  * The modal needs to display on the page, and the contents of the modal should populate with details about the person that we clicked.

* Ask the class the following question(s):

  * "What needs to happen when a user clicks the `save` button?"

  * The modal needs to disappear.

  * We need some way of keeping track of which person has which description.

* Ask the class the following question(s):

  * 'How can we make our web applications more interactive?'

* Use student answers to transition to the next demo.

### 3.  Instructor Do: On Click Demo  (5 min)

6:45-50

* Open [10-Ins_Onclick/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/04-web-apis/2-tuesday-js-events/activities/10-Ins_Onclick/index.html) in the browser and demonstrate its functionality:

  * When we click on the toggle switch, the background color of the navigation and the footer both change colors.

* Open [10-Ins_Onclick/script.js](../../../UW-SEA-FSF-PT-11-2019-U-C/04-web-apis/01-Activities/10-Ins_Onclick/script.js) in your IDE and point out the following:

  * We assign each queried element to a variable so that we can reuse it.

  ```js
  var themeSwitcher = document.querySelector("#theme-switcher");
  var container = document.querySelector(".container");
  ```

  * `addEventListener` is the DOM method responsible for listening to events on an element.

  * `addEventListener` has 2 required parameters: The type of event to listen for and a callback function to execute when that event is triggered.

  ```js
  themeSwitcher.addEventListener("click", function() {
    if (mode === "dark") {
      mode = "light";
      container.setAttribute("class", "light");
    } else {
      mode = "dark";
      container.setAttribute("class", "dark");
    }
  });
  ```

### 4.  Students Do: addEventListener (15 min)

6:50-7:05

[11-Stu_Onclick/Unsolved](../../../UW-SEA-FSF-PT-11-2019-U-C/11-Stu_Onclick/Unsolved)

### 5. Instructor Do: Review addEventListener (5 min)

7:05-10

* Open the file [11-Stu_Onclick/Solved/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/11-Stu_Onclick/Solved/index.html) in the browser.

  * Clicking on the increment or decrement buttons raises or lowers our number dependant on which button we click.

  * The count in the middle gets updated every time the button gets pressed.

  * The count never falls below 0.

* Open [11-Stu_Onclick/Solved/script.js](../../../UW-SEA-FSF-PT-11-2019-U-C/11-Stu_Onclick/Solved/script.js) in your IDE.

  * We initialize global variables for `count` variable, `incrementEl`, and the `decrementEl` elements in DOM.

  ```js
  var count = 0;
  var incrementEl = document.querySelector("#increment");
  var decrementEl = document.querySelector("#decrement");
  ```

  * The second argument of `addEventListener` is an anonymous callback function. This function will execute the body of the callback each time the event is triggered.

  ```js
  incrementEl.addEventListener("click", function() {
    count++;
    setCounterText();
  });
  ```

  * 🗒 Note that many students may have appended the count to the page inline instead of breaking it out into its own function.

  * To complete the bonus we need a conditional that ensures that the count only decrements if the current value is greater than 0.

  ```js
  decrementEl.addEventListener("click", function() {
    if(count > 0) {
      count--;
      setCounterText();
    }
  }); 
  ```

### 6. Instructor Do: Demo event.preventDefault (10 min)

7:10-20

* Forms also have default behaviors that occur on submission.

* What happens if you refresh a page that has form data?

[12-Ins_Preventing_Default_Events/index.js](../../../UW-SEA-FSF-PT-11-2019-U-C/12-Ins_Preventing_Default_Events/index.html)

  * Enter values into the input fields and click on the submit button.

  * Demonstrate that the entire click object appears in the console.

### 7. Student Do: Tip Calculator (15 min)

7:20-35

[13-Stu_Preventing_Default_Events/Unsolved](../../../UW-SEA-FSF-PT-11-2019-U-C/13-Stu_Preventing_Default_Events/Unsolved)

### 8. Instructor Do: Review Tip Calculator (5 min)

7:35-40

[13-Stu_Preventing_Default_Events/Solved/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/13-Stu_Preventing_Default_Events/Solved/index.html)

* pseudocode first

  * when I click calculate tip
    * total * percent
    * nearest cent
    * show tip amount and total
  * when I click split
    * divide total by number of people
    * update the page

* HTML

  * `type=number`
  * `min=0`

* JavaScript

  * `preventDefault`
  * No functions are actually executed until the bottom of the file
  * `toFixed(n)` round to nearest cent
  * Even though `total` and `tipPercentage` are strings, we can still multiply them. This is because in JavaScript, the `*` operator coerces both arguments from strings into numbers before multiplying them. This is also the case for all arithmetic operators *except* for addition.
  * Since both `total` and `tipAmount` are strings, we need to convert them into numbers before adding them. Remind students that the `+` operator concatenates strings.
  * The bonus can be achieved by taking the text content of the `total` element and dividing it by the value from a field that describes how many people to split the bill between.

### 9. Instructor Do: Demo Key Events (5 min)

7:40-45

[14-Ins_Other_Events/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/14-Ins_Other_Events/index.html)

### 10. Student Do: Listening For Other Events (15 min)

7:45-8

[15-Stu_Other_Events/Unsolved](../../../UW-SEA-FSF-PT-11-2019-U-C/15-Stu_Other_Events/Unsolved)

### 11. Instructor Do: Review Other Events (5 min)

8-05

[15-Stu_Other_Events/Solved/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/15-Stu_Other_Events/Solved/index.html)

* Ask: Why does clicking on a blank spot on the page add the entire page to `target`?

[15-Stu_Other_Events/Solved/script.js](../../../UW-SEA-FSF-PT-11-2019-U-C/15-Stu_Other_Events/Solved/script.js)

### 12. Everyone Do: BREAK (15 min)

805-20

### 13. Instructor Do: Demo Event Bubbling and Propagation (10 min)

820-30

[16-Ins_Event_Bubbling/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/16-Ins_Event_Bubbling/index.html)

* We have a click event listener on each div

* What will happen when we click the innermost div?

* What about the middle one?

* Why?

* discuss `event.stopPropagation`

* whiteboard the DOM tree

* show the event bubble up

### 14. Student Do: Event Bubbling (20 min)

830-50

[17-Stu_Event_Bubbling/Unsolved](../../../UW-SEA-FSF-PT-11-2019-U-C/17-Stu_Event_Bubbling/Unsolved)

### 15. Instructor Do: Review Event Bubbling (5 min)

850-55

[17-Stu_Event_Bubbling/Solved/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/17-Stu_Event_Bubbling/Solved/index.html)

### 16. Instructor Do: Event Delegation Demo (10 min)

855-905

  * What if we need to assign event listeners to several objects on the page? Is there a way that we can easily handle all of these events without duplicating code?

  * Students may reply with a `for` loop. This would work, but it still requires us to create several event listeners.

[18-Ins_Event_Delegation/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/18-Ins_Event_Delegation/index.html)

* Show the students the code in `index.html` but do not open `script.js` yet.

* Then, open `index.html` in the browser and add a couple of items to the shopping cart.

  * Ask the students what JavaScript code they think is necessary for this behavior. Specifically, ask them where they would set up the event listeners.

  * Students may suggest that the event listener is added to each button. 

* Open `script.js` and direct students to the `addEventListener` line. 

  * Note that the event listener was added to the entire list. Then, within the callback, we determine whether or not the clicked item was a button or not by using `event.target.nodeName`. This technique is known as **event delegation**. 

  * Be sure to mention that event delegation is the technique of listening for events on a parent element, then **delegating** those events differently, depending on the target.

### 17. Student Do: Event Delegation (20 min)

905-25

This is what we've been building up to and is the last activity

Create the friends list app showed at the beginning

[19-Stu_Event_Delegation/Unsolved](../../../UW-SEA-FSF-PT-11-2019-U-C/19-Stu_Event_Delegation/Unsolved)

### 18. Instructor Do: Review Event Delegation (5 min)

925-30

pseudocode

* clicking edit shows a dialog

  * clicking save stores a description associated with that person being edited
  * closing the dialog with "X" discards that info
  * clicking "X" stops displaying the dialog

* Clicking "Add Person" creates a new list item to add to the end of the friend list
  * has a default description of empty string
  * we display all the previous people plus the newly added friend

* none of the above should clear anything

* draw DOM

[19-Stu_Event_Delegation/Solved/index.html](../../../UW-SEA-FSF-PT-11-2019-U-C/19-Stu_Event_Delegation/Solved/index.html)

  * In `handleClick`, we check to see if the element clicked is a `button`. This is sufficient because this is the only button element on the page at this time.

  * Then we set up variables for the name and description of the person that we clicked on.

  * The `textContent` of the modal header is set to the name and the value of the description textarea is set to any existing description. The logical OR operator ensures that the description is set to an empty string if the value in our array is undefined.

  * Remind students that `save` isn't actually persisting the data in a database. We are simply updating the description property of the current person in our people array. This data will remain until we close the browser or reload the page.

  * To setup the behavior to close when the modal is clicked away from, we add an event listener to the document object. We use event delegation to check if the element clicked is the modal container. If so, we close the modal.
