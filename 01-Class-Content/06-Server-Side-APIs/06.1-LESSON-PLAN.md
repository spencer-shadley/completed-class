# 6.1 - Intro to APIs and AJAX

- Before class, create an account at [RapidAPI](https://rapidapi.com/).

- This week's Giphy activities will require students to use an API key from [Giphy API](https://developers.giphy.com/). Please have them create an account and apply for a key before class starts in order to have it approved and activated in time for the activity.

- Be sure to slack out this [tutorial on the OpenWeatherMap API](http://osp123.github.io/tutorials/html/weatherAPI.html) as pre-reading for this week's content.

- Keep in mind that since Heroku serves its content using HTTPS, all external resources need to use HTTPS as well, else they may be blocked by the browser. Most examples in the Giphy documentation use HTTP, but HTTPS is available as well. This isn't likely to pose an issue today, but students may run into it when they deploy their homework assignments. Some additional information:

  - [Mixed active content](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content#Mixed_active_content)

  - [How to fix a website with mixed active content](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content/How_to_fix_website_with_mixed_content)

Install [JSON Viewer](https://chrome.google.com/webstore/detail/json-viewer/gbmdgpbipfallnflgajpaliibnhdgobh?hl=en-US)

### Students Do: 01-CustomerObject

10-05 (5 min)

simple warm-up activity

### Instructor Do: Review 01-CustomerObject

1005-10 (5 min)

fill in the `console.log`s

live code

### Instructor Do: New York Times Scraper Demo

1010-20 (10 min)

[NYT Scraper](http://nyt-mongo-scraper.herokuapp.com/)

Scrape new articles retrieves from New York Times with a "Save" button

show the API in the network tab

[NYT Scraper API](http://nyt-mongo-scraper.herokuapp.com/api/headlines)

it's storing this as JSON (JavaScript objects) with multiple types

this is really common to send data

### Everyone Do: 02-1-nyt-scraper

1020-25 (5 min)

try it out - look at the data

ask questions as you read

Ask: Explain how this is working

### Students Do: 02-2-api-research

1025-32 (7 min)

students do self-research on APIs

### Everyone Do: Review 02-2-api-research

1032-37 (5 min)

Have students share their answers to these questions.

### Instructor Do: API Experimenting

1043-53 (10 min)

Find a fact about a number

[Numbers](https://rapidapi.com/divad12/api/numbers-1)

[Anime](https://rapidapi.com/vikhyat/api/hummingbird-v1)

[PokeAPI](https://pokeapi.co/)

### Instructor Do: API Definitions

1037-43 (6 min)

Imagine building a computer for scratch. Let's pretend the hardware is all good.

It's virtually impossible. We need building blocks. Those building blocks become APIs that can be shared and reused.

Show airbnb using Google Maps APIs

Have you heard of How to Make Everything
How to Make a \$1,500 sandwich in only 6 months
https://www.youtube.com/watch?v=URvWSsAgtJE&vl=en

To get cheese - drive to a farm, milk a cow, harvest wheat, ferment, etc. and you eventually get a slice of cheese

Even jQuery is just a bunch of APIs [jQuery](https://jquery.com/)

We will cover APIs in more detail in future classes

### Students Do: API Experimenting

1053-1103 (10 min)

Use rapidapi to find more APIs and experiment

### Instructor Do: OMDb API Demo

1103-08 (5 min)

- Navigate to the [OMDb API](http://www.omdbapi.com/) and explain that this API provides a database of information on nearly every movie in existence.

- Scroll through the basic documentation and point out that in this API, we "build" URLs that point to JSONs associated with various movies. Point out that the parameters allow us to filter results. Inform students that the OMDb API is no longer a free API and requires an API key which we will provide for them to use.

- Then use Example GUI to generate a URL for a movie of your choice.

- Then visit the link that gets generated, and show students the JSON that was generated. Be sure to add the following `apikey` parameter to the generated URL: `trilogy`. Example: <http://www.omdbapi.com/?t=Space+Jam&apikey=trilogy>

- Ask students if they have any questions.

### Partners Do: OMDb API Exploration

1108-18 (10 min)

- Have students explore the OMDb API themselves.

### Everyone Do: OMDb API URLs

1118-28 (10 min)

- Using this <http://www.omdbapi.com/?t=Forrest+Gump&y=&plot=short&apikey=trilogy> as an example, have students break down the URL.

- Be sure to have them explain each parameter listed (i.e. the `?t`, the `+`, the `&`, `apikey=`, etc).

- Then ask students how they would show multiple movies that meet a condition? (i.e. how would you get all movies with the word `Matrix` in it). SOLUTION: Use the `/s` format: <http://www.omdbapi.com/?s=Matrix&y=&plot=short&apikey=trilogy>

### BREAK

1128-1208 (40 min)

### Instructor Do: AJAX Query Demo

1208-18 (10 min)

- Now open up your editor and create an AJAX call to OMDb using the below code as an example. (Alternatively, you can use [02-Ajax_OMDB/single-ajax.html]. If making your own AJAX call, however, be sure to include a few console logs after the AJAX call to demonstrate asynchronicity. See `single-ajax.html` for details.

- Be sure to point out the various parts of the AJAX call:

  - The `queryURL` which points to the JSON
  - The `GET` method which tells JavaScript to download the JSON
  - The `then` function which tells JavaScript to run the code inside ONLY when done with the download
  - Most importantly that all of the data is being stored in the `response` object-2.9
  - Lastly, in your Chrome inspector, point out how all the code past line 26 happens before the results of our API call are logged. Even though that happens first lexically.

- Ask students why they think the `.then` function is necessary? Why does the code after the AJAX request happen before the API results are logged?

- After a minute or two of discussion, explain to students that JavaScript is synchronous in nature. The code is executed one line at a time.

  - This makes the language easier to pick up initially, as code executes in the order one might expect.

  - But what if our API call takes a few seconds to come back? What if it takes a minute? Ten minutes? An hour?

    - While we won't be waiting on a request for TOO long, it does pose a problem when we have other code that needs to run no matter what the API response is. Just waiting for the API call to complete to execute other unrelated code isn't very efficient and doesn't provide a good user experience. So JavaScript can BEHAVE asynchronously through the use of callback functions and promises.

  - We have already seen asynchronous behavior through callbacks with setTimeout and setInterval. We pass setTimeout and setInterval callback functions to execute whenever they're ready, WHENEVER that may be.

  - Promises are similar. The .then function is an example of a promise. This is essentially a function that "promises" to be executed at some point. In this case, whenever our data comes back from the API. We describe what we want to happen by passing a callback function as a parameter into our promise.

  - In short, because the AJAX request takes a certain amount of time, our code after AJAX call executes in the meantime. Remember, AJAX stands for ASYNCHRONOUS JavaScript and XML.

- Run the code and show the results in the console.

- Add a second AJAX call to another movie. (Alternatively you can use [02-Ajax_OMDB/multiple-ajax.html](../../../../01-Class-Content/06-Server-Side-APIs/01-Activities/02-Ajax_OMDB/multiple-ajax.html).

- Open the floor to questions.

- Slack out the code you just created.

### Everyone Do: Logging JSON

1218-23 (5 min)

- Ask students how they might parse out and retrieve the movie's runtime or actors list in response? (Show the JSON on the side).

### Students Do: 02-5-ajax-query

1223-38 (15 min)

### Students Do: 03-AJAX_to_HTML

1238-53 (15 min)

### Instructor Do: Review 03-AJAX_to_HTML

1253-1 (7 min)

- Ask students why we put the code we want to execute after the AJAX call is complete inside the .then promise function?

- Be sure to mention that because AJAX is asynchronous, this guarantees response is ready when we try and use it.

- Take a moment to go over the bonus solution and demonstrate how we can place repetitive logic inside of functions. This helps make our code easier to understand and reduces the number of lines of code we need to maintain and debug.

### Partners Do: Giphy Documentation

1-110 (10 min)

[Giphy API Documentation](https://developers.giphy.com/docs/)

- Let students know that their homework will use the Giphy API Documentation

### Instructor Do: 04-Giphy_API

110-20 (10 min)

- Point out the API key that needed to be appended to the end of your query URL.

### Instructor Do: Homework Intro

120-25 (5 min)

- [homework demo](https://youtu.be/BqreERTLjgQ) file or showcase the final solution file in the browser.
  ^ wrong HW?

### Students Do: Homework Intro

125-30 (5 min)

(optional)

- If any time remains, have students create their own AJAX calls to the Giphy API. Have them try to create a website with buttons that launch searches for Gifs associated with specific terms.

### Instructor Do: API Key Reminder For Next Class (1 mins)

130-31 (1 min)

- Next classes Weather in Bujumbura Activity will require students to use an API key from [OpenWeatherMap API](http://openweathermap.org/api). Please have them apply for one before our next class starts in order to have it approved and activated in time for the activity.

### Switchboard

131-51

review algorithms?

go over bonus activities?

review?
